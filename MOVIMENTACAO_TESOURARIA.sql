DECLARE @ANO INT
SET @ANO = 2018

DECLARE @MES INT
SET @MES = 5

DECLARE @EMP INT
SET @EMP = 1

SELECT
ENTRADA.DTNEG
,ENTRADA.ENTRADA
,SAIDA.SAIDA
,(ENTRADA.ENTRADA - SAIDA.SAIDA) AS SALDO_DO_DIA


FROM

(
SELECT
CAB.DTNEG
,SUM(FIN.VLRDESDOB) AS ENTRADA

FROM
TGFCAB CAB
,TGFFIN FIN

WHERE
YEAR(CAB.DTNEG) = @ANO
AND MONTH(CAB.DTNEG) = @MES

AND CAB.CODTIPOPER IN (1112,1101)
AND CAB.NUMNOTA = FIN.NUMNOTA
AND CAB.DTNEG = FIN.DHMOV
AND CAB.DTNEG = FIN.DHBAIXA
AND FIN.CODTIPTIT IN (1,6)
AND CAB.CODEMP=@EMP

GROUP BY
CAB.DTNEG
) AS ENTRADA

LEFT OUTER JOIN

(
SELECT 
CAB.DTNEG
,SUM(CAB.VLRNOTA) AS SAIDA

FROM 
TGFCAB CAB

WHERE
CAB.CODTIPOPER = 1304
AND YEAR(CAB.DTNEG) = @ANO
AND MONTH(CAB.DTNEG) = @MES
AND CAB.CODEMP=@EMP

GROUP BY
CAB.DTNEG
) AS SAIDA

ON ENTRADA.DTNEG = SAIDA.DTNEG

ORDER BY
ENTRADA.DTNEG
